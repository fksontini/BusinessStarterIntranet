<html xmlns:mso="urn:schemas-microsoft-com:office:office" xmlns:msdt="uuid:C2F41010-65B3-11d1-A29F-00AA00C14882"> 
<head>
<title>Intranet Event Item</title>

<!--[if gte mso 9]><xml>
<mso:CustomDocumentProperties>
<mso:TemplateHidden msdt:dt="string">0</mso:TemplateHidden>
<mso:ManagedPropertyMapping msdt:dt="string">'Picture URL'{Picture URL}:'PublishingImage','Link URL'{Link URL}:'Path','Title'{Title}:'Title','News Summary'{News Summary}:'PublishingPageContentOWSHTML','News Publishing Date'{News Publishing Date}:'IntranetContentPublishingDateOWSDATE','Refiner'{Refiner}:'RefinableString02','SecondaryFileExtension','ContentTypeId','StartDateOWSDATE','RefinableString05','LocationOWSTEXT','ListItemID'</mso:ManagedPropertyMapping>
<mso:MasterPageDescription msdt:dt="string">Displays event item in a list format.</mso:MasterPageDescription>
<mso:ContentTypeId msdt:dt="string">0x0101002039C03B61C64EC4A04F5361F385106603</mso:ContentTypeId>
<mso:TargetControlType msdt:dt="string">;#Content Web Parts;#</mso:TargetControlType>
<mso:HtmlDesignAssociated msdt:dt="string">1</mso:HtmlDesignAssociated>
<mso:HtmlDesignConversionSucceeded msdt:dt="string">True</mso:HtmlDesignConversionSucceeded>
<mso:CrawlerXSLFile msdt:dt="string"></mso:CrawlerXSLFile>
<mso:HtmlDesignPreviewUrl msdt:dt="string"></mso:HtmlDesignPreviewUrl>
<mso:DisplayTemplateLevel msdt:dt="string">Item</mso:DisplayTemplateLevel>
<mso:HtmlDesignStatusAndPreview msdt:dt="string">http://spfarm-devlab.eastus2.cloudapp.azure.com/sites/test/_catalogs/masterpage/Display Templates/Content Web Parts/PnP/Item_Intranet-Event.html, Conversion successful.</mso:HtmlDesignStatusAndPreview>
</mso:CustomDocumentProperties>
</xml><![endif]-->

<style type="text/css">
.style1 {
	text-decoration: underline;
}
</style>

</head>

<body>

    <div id="Item_WebPage">

    <!--#_
        // Thanks to this post http://sharepointificate.blogspot.ca/2016/06/search-display-templates-made-easy-w.html

        var encodedId = $htmlEncode(ctx.ClientControl.get_nextUniqueId());
        var containerId = "NewsItem_" + encodedId;
        var currentItem = ctx.CurrentItem;
        var currentItemId = ctx.CurrentItemIdx + 1;
        var groupRowCount = ctx.CurrentGroup.RowCount;
        
        if(currentItemId === groupRowCount ) {
                
    		isLastItem = true;
   		}	

        // Get the refiner managed property
        // To be consistent, this managed property must be used as a filter in the search query as well (unique value)
        // By default 'RefinableString02' = 'owstaxIdIntranetContentType'
        var refinerManagedProperty = $getItemValue(ctx, "Refiner");
        
        // Get the URL of the news image with the correct rendition
        var image = $getItemValue(ctx, "Picture URL");
        var imageUrlWithRendition = Srch.U.getImageSourceWithRendition(image, 100, 100);
        
        // Remove existing rendition parameter is there is one
        imageUrlWithRendition  = imageUrlWithRendition.replace(/\?RENDITIONID=.&/gi, "?");

        AddPostRenderCallback(ctx, function() {

            Intranet.Main.initPageDisplayTemplateItemViewModel(currentItem, document.getElementById(containerId), refinerManagedProperty.managedPropertyName, refinerManagedProperty.inputValue ,"allLabel");
            
            // Little trick to move the "View all" link a the end of all tiles (centered). We take the link generated by the last item (see below in the display template.
			// Then we move this element at the end of the tile control. Don't forget to add the 'stopBinding: true' binding to avoid multiple Knockout bindings on the same element.   		   
            if(isLastItem) {
            
                var $ = Intranet.Main.jQuery();
            	var parent = $("#" + containerId).closest("ul");
            	var allItemsLink = $("#" + containerId).children(".all-items-link");
            	allItemsLink.attr('data-bind', 'stopBinding: true');
            	allItemsLink.appendTo(parent);   	
       		}	

        });
        
    _#-->

    <div data-bind="stopBinding: true">
        <div class="item-display-template">
            <div id="_#=containerId=#_" class="event-item">
                        
                <!-- ko with: item -->
                        
                    <div class="event-dates">
                    
							<p class="event-date date-box">
							    <!-- ko if: $data.StartDateOWSDATE-->
								<i class="month" data-bind="formatDateField: StartDateOWSDATE, dateFormat : 'MMM'"></i> 
								<!-- /ko -->
								<!-- ko if: $data.StartDateOWSDATE-->
								<i class="day" data-bind="formatDateField: StartDateOWSDATE, dateFormat : 'DD'"></i>
								<!-- /ko -->
							</p>
							
							<!-- ko if: $data.RefinableString05 -->
							
								<!-- ko if: RefinableString05 != StartDateOWSDATE -->
								
								<i class="fa fa-arrow-right arrow" aria-hidden="true"></i>
								<p class="event-date date-box">
									<i class="month" data-bind="formatDateField: RefinableString05, dateFormat : 'MMM'"></i> 
									<i class="day" data-bind="formatDateField: RefinableString05, dateFormat : 'DD'"></i>
								</p>
								<!-- /ko -->
							<!-- /ko -->
							
					</div>
					
					<div class="event-infos">
						<i class="fa fa-clock-o" aria-hidden="true"></i>
						<div class="event-time">
							<!-- ko if: $data.StartDateOWSDATE-->
	                        <span data-bind="formatDateField: StartDateOWSDATE, dateFormat : 'HH:mm A'"></span >
	                        <!-- /ko -->
                            <!-- RefinableString05 = EndDateOWSDATE (we can't use managed property aliases in display templates) -->
	                        <!-- ko if: $data.RefinableString05 -->
	                        -
	                        <span data-bind="formatDateField: RefinableString05, dateFormat : 'HH:mm A'"></span >
	                        <!-- /ko -->
						</div>
											
						<!-- ko if: $data.LocationOWSTEXT-->
						<i class="fa fa-map-marker " aria-hidden="true"></i>
                        <p data-bind="summarize: { html: LocationOWSTEXT}, linesCount: 1, tooltip: 1"></p>
                        <!-- /ko -->
                        
                        <component-icsgenerator params='eventItemId: $data.ListItemID, displayMode: 2'></component-icsgenerator>
                        
						<a data-bind="attr: { href: Path }">
							<!-- ko if: $data.Title -->
							<p class="event-summary" data-bind="summarize: { html: Title}, linesCount: 2, tooltip: 1"></p>
							<!-- /ko -->
						</a> 
					</div>
					                       
                <!-- /ko -->
        
                <!--#_
                
                // Check if it is the last item to process and refiner managed metadata has been specified
                var currentItemIdx = ctx.CurrentItemIdx + 1;
                
                if(currentItemIdx === ctx.CurrentGroup.RowCount && !refinerManagedProperty.isNull) {
                _#-->
                    <div class="all-items-link">
                        <i class="fa fa-arrow-circle-o-right" aria-hidden="true"></i>
                        <a data-bind="text: allLabel, attr: { href: searchPageUrl }, getSearchUrl: true"></a>
                    </div>
                <!--#_
                }
                _#-->
            
            </div>
        </div>
    </div>

    </div>

</body>
</html>